{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="form-inline float-right">
        <select name="search" id="search" class="form-control form-control-sm">
            <option value="-1" {% if search == '' or search == -1 %} selected {% endif %}>검색대상</option>
            <option value="0" {% if search == 0 %} selected {% endif %}>제목</option>
            <option value="1" {% if search == 1 %} selected {% endif %}>내용</option>
            <option value="2" {% if search == 2 %} selected {% endif %}>제목+내용</option>
            <option value="3" {% if search == 3 %} selected {% endif %}>작성자</option>
        </select>
        <input type="text" name="keyword" id="keyword" class="form-control form-control-sm" {% if keyword != ""%} value={{keyword}} {% endif %}>
        <input type="button" value="검색" class="form-control form-control-sm" onclick="search()">
        <a href="/write"><button type="button" class="btn btn-outline-secondary btn-sm float-right m-2">
            글쓰기
        </button></a>
    </div>

    <div>
        <table class="table table-sm table-hover table-borered">
            <thead class="text-center">
                <tr>
                    <th>번호</th>
                    <th>제목</th>
                    <th>작성자</th>
                    <th>작성일</th>
                    <th>조회수</th>
                    <th>등불수</th>
                </tr>
            </thead>
            {% if lists.count() > 0 %}
                <tbody class="text-center">
                    {% for item in lists %}
                    <tr>
                        <td>{{ item['num'] }}</td>
                        <td class="text-left"><a class="text-reset"
                                href="{{  url_for('board_view', idx=item._id)}}">{{ item['title'] }}</a></td>
                        <td>{{ item['name'] }}</td>
                        <td>{{ item['date']|formatdatetime }}</td>
                        <td>{{ item['view'] }}</td>
                        <td>0</td>
                    </tr>
                    {% endfor %}
                </tbody>
            {% endif %}
        </table>
        {% if lists.count() > 0 %}
            <div class="text-center">
                <ul class="pagination justify-content-center">
                {% if block_start - 1 > 0 %}
                    <li class="page-item"><a class="page-link" href="{{url_for('main_page', page=block_start-1, search=search, keyword=keyword)}}">[이전]</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link disabled">[이전]</a></li>
                {% endif %}
        
                {% for i in range(block_start, block_last + 1) %}
                    {% if i > last_page %}
                        <li class="page-item"><a class="page-link disabled">{{ i }}</a></li>
                    {% else %}
                        {% if i == page %}
                            <li class="page-item"><a class="page-link active text-warning">{{i}}</a></li>
                        {% else %}
                            <li class="page-item"><a class="page-link" href="{{url_for('main_page', page=i, search=search, keyword=keyword)}}">{{ i }}</a></li>
                        {% endif %}
                    {% endif %}
                {% endfor %}
        
                {% if block_last < last_page %}
                    <li class="page-item"><a class="page-link" href="{{url_for('main_page', page=block_last+1, search=search, keyword=keyword)}}">[다음]</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link">[다음]</a></li>
                {% endif %}
                </ul>
            </div>
        {% endif %}
    </div>
</div>

<script>
    function search() {
        var val_search = document.getElementById("search").value;
        var val_keyword = document.getElementById("keyword").value;

        if(val_search == "" || val_keyword == "") {
            return false;
        } else {
            self.location.href = "{{url_for('main_page')}}?search=" + val_search + "&keyword=" + val_keyword;
        }
    }
</script>
{% endblock %}